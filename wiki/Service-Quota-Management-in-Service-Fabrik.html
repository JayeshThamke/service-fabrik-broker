<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Service Fabrik Wiki</title>
<link href="../css/font-awesome.min.css" rel="stylesheet">
<link href="../css/service-fabrik.css" rel="stylesheet">
<link href="../img/favicon.ico" rel="SHORTCUT ICON">
<script src="../js/jquery.min.js" type="text/javascript"></script>
</head>
<body class="preload">
<div class="container-fluid-custom">
<div class="row">
<nav>
<a href="https://github.com/sap/service-fabrik-broker/">
<center>
<img src="../img/service-fabrik.svg" width="235" height="320" />
</center></a>
<ul class="custom">
	<li><a style="border: 0px;" href="../index.html">&#9726; Home page</a></li>
	<li><a style="border: 0px;" href="../api/broker_v1.0.html">&#9726; Broker API Reference</a></li>
	<li><a style="border: 0px;" href="../api/agent_v1.1.html">&#9726; Agent API Reference</a></li>
	<li><a style="border: 0px;" href="../backup-restore-library/overview.html">&#9726; Backup &amp; Restore Library</a></li>
	<li><a style="border: 0px;" href="../wiki/Home.html">&#9726; Wiki</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="current reference internal" href="Home.html">Home</a></li><li class="toctree-l1"><a class="current reference internal" href="Architecture.html">Architecture</a></li><li class="toctree-l1"><a class="current reference internal" href="Big-Picture.html">Big-Picture</a></li><li class="toctree-l1"><a class="current reference internal" href="Bootstrap-BOSH-2.0-with-local-VirtualBox.html">Bootstrap-BOSH-2.0-with-local-VirtualBox</a></li><li class="toctree-l1"><a class="current reference internal" href="Deployment-hooks-for-service-lifecycle-operations.html">Deployment-hooks-for-service-lifecycle-operations</a></li><li class="toctree-l1"><a class="current reference internal" href="Extend-service-instance-Dashboard.html">Extend-service-instance-Dashboard</a></li><li class="toctree-l1"><a class="current reference internal" href="Patch-Review-&-Acceptance.html">Patch-Review-&-Acceptance</a></li><li class="toctree-l1"><a class="current reference internal" href="Process-Guidelines.html">Process-Guidelines</a></li><li class="toctree-l1"><a class="current reference internal" href="Process-to-Submit-a-Patch.html">Process-to-Submit-a-Patch</a></li><li class="toctree-l1"><a class="current reference internal" href="Resource-structure,-Locking-and-Unlocking-with-apiserver.html">Resource-structure,-Locking-and-Unlocking-with-apiserver</a></li><li class="toctree-l1"><a class="current reference internal" href="Resources.html">Resources</a></li><li class="toctree-l1"><a class="current reference internal" href="Running-Cloud-Foundry-with-BOSH-2.0.html">Running-Cloud-Foundry-with-BOSH-2.0</a></li><li class="toctree-l1"><a class="current reference internal" href="Service-Broker-Error-Codes.html">Service-Broker-Error-Codes</a></li><li class="toctree-l1"><a class="current reference internal" href="Service-Fabrik-Goals-Available-Features-&-Roadmap.html">Service-Fabrik-Goals-Available-Features-&-Roadmap</a></li><li class="toctree-l1"><a class="current reference internal" href="Service-Quota-Management-in-Service-Fabrik.html">Service-Quota-Management-in-Service-Fabrik</a></li>
</ul>
</nav>
<div class="content">
<header>
<h1 id="top">Service-Quota-Management-in-Service-Fabrik</h1>
</header>
<p>As a Service Provider, if one wants to define quotas on services provisioned, It can be possible using Service Fabrik. Here is how quota management works in Service Fabrik.</p>
<ul>
<li>It is possible to disable quota check, setting it in the settings file.</li>
</ul>
<pre><code>  ###################
# QUOTA MANAGEMENT SETTINGS #
###################
quota:
enabled: false
</code></pre><ul>
<li><p>If the quota check is turned on, then Service Fabrik does the quota check in the following way : </p>
<ul>
<li><p>It integrates with an entitlement service which is supposed to expose additional API that returns the quota assigned to a CF org for a given service and service plan <code>GET /orgs/{orgId}/services/{serviceName}/plan/{versionIndependentPlanName}</code> which returns the quantity as integer assigned to the given org for the specified service and service plan name (should be version independent). The details of the entitlement service and co-ordinates are to be added in the settings.</p>
<pre><code>###################
# QUOTA MANAGEMENT SETTINGS #
###################
quota:
enabled: true
oauthDomain: https:<span class="hljs-comment">//myauth-domain.com</span>
serviceDomain: https:<span class="hljs-comment">//my-tenant-onboarding.com</span>
username: quota_user
password: quota_password

</code></pre><p>Service Farbik Broker calls this API when a new service instance is created.</p>
</li>
<li><p>Already used quota is calculated calling CF and checking the number of service instances existing in the org. CF co-ordinates with admin user credential is necessary for the same.</p>
<pre><code>#############################
# CLOUD-CONTROLLER SETTINGS #
#############################
cf:
url: https:<span class="hljs-comment">//api.cf.&lt;mydomain&gt;.com</span>
username: admin
password: *****************
identity_provider: uaa
</code></pre></li>
<li><p>Remaining quota is calculated based on above two values and based on that provision request is allowed.</p>
</li>
</ul>
</li>
</ul>
<p><strong>Limitations</strong></p>
<ul>
<li>Assumes consuming platform to be only one and only Cloud Foundry</li>
<li>CF admin credentials are needed in order to get number of service instances in an organization.</li>
</ul>
</div>
</div>
</div>
<p class="text-muted" style="text-align: center;">Copyright &copy; SAP SE 2016.</p>
<p></p>
</body>
</html>
